<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OUTSOURCING RSUD TALAUD 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-red: #DC143C;
            --dark-red: #8B0000;
            --light-red: #FFB6C1;
            --medical-blue: #0056b3;
            --light-blue: #e6f2ff;
            --dark-gray: #2c3e50;
            --medium-gray: #7f8c8d;
            --light-gray: #ecf0f1;
            --white: #ffffff;
            --success-green: #28a745;
            --warning-yellow: #ffc107;
            --danger-red: #dc3545;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0;
            padding: 0;
            padding-bottom: 70px;
            overflow-x: hidden;
        }

        /* Header Styles */
        .main-header {
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--dark-red) 100%);
            color: white;
            padding: 12px 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            height: 60px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hospital-info {
            display: none;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-red);
            font-weight: bold;
            font-size: 14px;
        }

        .user-name {
            display: none;
        }

        /* Main Content */
        .main-content {
            margin-left: 0;
            padding: 15px;
            flex: 1;
            transition: all 0.3s ease;
            margin-top: 0;
            padding-bottom: 20px;
        }

        /* Page Title */
        .page-title {
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--dark-red) 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .page-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .page-title-content {
            flex: 1;
            min-width: 0;
        }

        .page-title h1 {
            font-size: 22px;
            font-weight: 700;
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .page-title p {
            margin: 5px 0 0 0;
            font-size: 13px;
            opacity: 0.9;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .page-title .logo-right {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        /* Real-time date and time display */
        .real-time-info {
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 6px;
            padding: 8px 15px;
            margin-top: 10px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .real-time-info i {
            color: rgba(255, 255, 255, 0.8);
        }

        .real-time-info .date-time {
            color: rgba(255, 255, 255, 0.9);
        }

        /* Beranda Page Styles */
        .welcome-section {
            background-color: var(--white);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary-red);
            text-align: center;
        }

        .welcome-section h3 {
            color: var(--primary-red);
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .welcome-section p {
            color: var(--dark-gray);
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .info-section {
            background-color: var(--white);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary-red);
        }

        .info-section h4 {
            color: var(--primary-red);
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-section p {
            color: var(--dark-gray);
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .info-section ul {
            color: var(--dark-gray);
            font-size: 16px;
            line-height: 1.6;
            padding-left: 20px;
            margin-bottom: 0;
        }

        .info-section li {
            margin-bottom: 8px;
        }

        .info-section .highlight {
            color: var(--primary-red);
            font-weight: 600;
        }

        .warning-section {
            background-color: #fff3cd;
            border-left: 4px solid var(--warning-yellow);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .warning-section h4 {
            color: #856404;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .warning-section p {
            color: #856404;
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 0;
        }

        /* Report Type Selection */
        .report-type-selection {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .report-type-card {
            flex: 1;
            background-color: var(--white);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .report-type-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .report-type-card.active {
            border-color: var(--primary-red);
            background-color: rgba(220, 20, 60, 0.05);
        }

        .report-type-card i {
            font-size: 36px;
            color: var(--primary-red);
            margin-bottom: 10px;
        }

        .report-type-card h4 {
            color: var(--dark-gray);
            font-size: 18px;
            margin-bottom: 5px;
        }

        .report-type-card p {
            color: var(--medium-gray);
            font-size: 14px;
        }

        /* Form Styles */
        .form-container {
            background-color: var(--white);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .form-title {
            color: var(--primary-red);
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
            font-size: 20px;
        }

        .form-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }

        .form-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .section-title {
            color: var(--primary-red);
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark-gray);
            font-size: 14px;
        }

        .form-control, .form-select {
            border: 1px solid #ced4da;
            border-radius: 6px;
            padding: 10px 15px;
            font-size: 14px;
            transition: all 0.3s ease;
            background-color: var(--white);
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-red);
            box-shadow: 0 0 0 0.2rem rgba(220, 20, 60, 0.25);
        }

        .btn-primary {
            background-color: var(--primary-red);
            border-color: var(--primary-red);
            padding: 12px 25px;
            font-weight: 600;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-size: 14px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary:hover {
            background-color: var(--dark-red);
            border-color: var(--dark-red);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 20, 60, 0.3);
        }

        /* Riwayat Page Styles */
        .history-container {
            margin-top: 20px;
        }

        .history-item {
            background-color: var(--white);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary-red);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .history-title {
            font-weight: 600;
            color: var(--primary-red);
            font-size: 16px;
        }

        .history-date {
            font-size: 12px;
            color: var(--medium-gray);
        }

        .history-content {
            margin-bottom: 10px;
        }

        .history-field {
            margin-bottom: 5px;
            font-size: 14px;
        }

        .history-label {
            font-weight: 600;
            color: var(--dark-gray);
        }

        .history-value {
            color: var(--medium-gray);
        }

        .history-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--light-gray);
        }

        .history-status {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            background-color: var(--light-red);
            color: var(--dark-red);
        }

        .history-actions {
            display: flex;
            gap: 10px;
        }

        .history-action-btn {
            background: none;
            border: none;
            color: var(--primary-red);
            cursor: pointer;
            font-size: 16px;
        }

        .empty-state {
            text-align: center;
            padding: 50px 20px;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .empty-state i {
            font-size: 48px;
            color: var(--medium-gray);
            margin-bottom: 15px;
        }

        .empty-state h5 {
            color: var(--medium-gray);
            font-size: 18px;
            margin-bottom: 8px;
        }

        .empty-state p {
            color: var(--medium-gray);
            font-size: 14px;
        }

        /* Bottom Navigation - Menu Ikon Permanen di Bawah */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--white);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid var(--light-gray);
            height: 70px;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5px 15px;
            text-decoration: none;
            color: var(--medium-gray);
            transition: all 0.3s ease;
            font-size: 11px;
        }

        .bottom-nav-item.active {
            color: var(--primary-red);
        }

        .bottom-nav-item i {
            font-size: 22px;
            margin-bottom: 3px;
        }

        .bottom-nav-item:hover {
            color: var(--primary-red);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 15px;
            background-color: var(--success-green);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: none;
            z-index: 2000;
            animation: slideIn 0.3s ease;
            max-width: 300px;
            font-size: 14px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Success overlay with motivation - OPTIMIZED FOR SPEED */
        .success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            z-index: 4000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }

        .success-content {
            text-align: center;
            background-color: var(--white);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 90%;
            width: 400px;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .success-icon {
            font-size: 64px;
            color: var(--success-green);
            margin-bottom: 25px;
            animation: bounce 0.5s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .success-title {
            font-size: 24px;
            color: var(--success-green);
            font-weight: 700;
            margin-bottom: 20px;
        }

        .success-message {
            font-size: 18px;
            color: var(--dark-gray);
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .success-message .highlight {
            color: var(--primary-red);
            font-weight: 600;
        }

        .success-countdown {
            font-size: 16px;
            color: var(--medium-gray);
            margin-top: 20px;
            font-weight: 500;
        }

        /* Photo preview */
        .photo-preview {
            margin-top: 10px;
            text-align: center;
        }

        .photo-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid var(--light-gray);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .page-title h1 {
                font-size: 18px;
            }
            
            .page-title p {
                font-size: 12px;
            }
            
            .page-logo {
                width: 40px;
                height: 40px;
            }
            
            .report-type-selection {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Success Overlay with Motivation -->
    <div id="successOverlay" class="success-overlay">
        <div class="success-content">
            <i class="bi bi-check-circle-fill success-icon"></i>
            <div class="success-title">Laporan Berhasil Terkirim!</div>
            <div class="success-message">
                <p class="highlight">Karyawan tidak usah menunggu</p> karena laporan telah masuk ke admin dan akan di proses lanjut.</p>
                <p>Silahkan melanjutkan pekerjaan dengan baik dan tetap semangat.</p>
                <p>Riwayat laporan Anda telah tersimpan secara permanen di perangkat ini.</p>
            </div>
            <div class="success-countdown" id="countdownText">
                Kembali ke beranda dalam <span id="countdownNumber">3</span> detik...
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Beranda Page -->
        <div id="beranda" class="page active">
            <!-- Page Title -->
            <div class="page-title">
                <img src="https://z-cdn-media.chatglm.cn/files/e8eeeb63-91db-4aba-846e-a668ffcce588.png?auth_key=1869369634-33607f0815054dd480ad50924e93be9e-0-fa826bc662af2f6175504c8eeb725f06" alt="Logo Kabupaten Talaud" class="page-logo">
                <div class="page-title-content">
                    <h1>Outsourcing RSUD Talaud 2026</h1>
                    <p>Sistem Pelaporan Karyawan</p>
                    <div class="real-time-info">
                        <i class="bi bi-calendar3"></i>
                        <span class="date-time" id="berandaDateTime"></span>
                    </div>
                </div>
                <img src="https://z-cdn-media.chatglm.cn/files/d5a31111-e79f-406f-9c31-a71f6bf5e72d.png?auth_key=1869369634-ebd2d760cbe84bd1b54a3d72851d8f42-0-c320d702f01d0d94e6042dd3dc574f92" alt="Logo Keamanan dan Kesehatan Kerja" class="page-logo logo-right">
            </div>
            
            <!-- Welcome Section -->
            <div class="welcome-section">
                <h3><i class="bi bi-house-heart"></i> Selamat Datang</h3>
                <p>Silakan gunakan menu di bawah untuk membuat laporan kegiatan harian Anda. Laporan akan disimpan secara permanen di perangkat ini dan dikirim untuk diproses lebih lanjut. Harap jangan menghapus aplikasi agar riwayat laporan Anda tidak hilang.</p>
            </div>

            <!-- Working Hours Information -->
            <div class="info-section">
                <h4><i class="bi bi-clock-history"></i> Jam Kerja</h4>
                <p>Berikut adalah informasi jam kerja untuk berbagai jenis karyawan:</p>
                <ul>
                    <li><span class="highlight">Cleaning Service (Ruangan Rawat Inap & Rawat Jalan) serta Penata Halaman:</span> Senin sampai Sabtu</li>
                    <li><span class="highlight">Limbah RS:</span> Senin sampai Minggu</li>
                    <li><span class="highlight">Karyawan IPSRS:</span> 24 jam menyesuaikan jadwal ruangan</li>
                    <li><span class="highlight">Administrasi:</span> Senin sampai Jumat</li>
                </ul>
            </div>

            <!-- Pengawas Lapangan yang Ditunjuk oleh Perusahaan -->
            <div class="info-section">
                <h4><i class="bi bi-person-badge"></i> Pengawas Lapangan yang Ditunjuk oleh Perusahaan</h4>
                <p><strong>Pengawas : Andriski Mangalo</strong></p>
                <p><strong>Peran:</strong> Bertanggung jawab atas pengawasan dan evaluasi kinerja karyawan outsourcing di seluruh area RSUD Talaud.</p>
            </div>

            <!-- Warning Section - Perhatian Penting -->
            <div class="warning-section">
                <h4><i class="bi bi-exclamation-triangle"></i> Perhatian Penting</h4>
                <p><strong>Aturan Kehadiran:</strong> Anda wajib melaporkan kegiatan harian setiap hari bekerja.</p>
                <p><strong>Sanksi:</strong> Jika Anda tidak bekerja selama 2 hari berturut-turut tanpa memberikan keterangan yang jelas, kontrak kerja Anda akan dihentikan oleh perusahaan.</p>
                <p><strong>Penting:</strong> Pastikan selapapun kondisinya, selalu lakukan pelaporan kegiatan harian Anda agar kontrak kerja tetap berjalan.</p>
            </div>
        </div>

        <!-- Buat Laporan Page -->
        <div id="laporan" class="page" style="display: none;">
            <div class="page-title">
                <img src="https://z-cdn-media.chatglm.cn/files/e8eeeb63-91db-4aba-846e-a668ffcce588.png?auth_key=1869369634-33607f0815054dd480ad50924e93be9e-0-fa826bc662af2f6175504c8eeb725f06" alt="Logo Kabupaten Talaud" class="page-logo">
                <div class="page-title-content">
                    <h1>Pilih Jenis Laporan</h1>
                    <p>Sistem Pelaporan Karyawan</p>
                    <div class="real-time-info">
                        <i class="bi bi-calendar3"></i>
                        <span class="date-time" id="laporanDateTime"></span>
                    </div>
                </div>
                <img src="https://z-cdn-media.chatglm.cn/files/d5a31111-e79f-406f-9c31-a71f6bf5e72d.png?auth_key=1869369634-ebd2d760cbe84bd1b54a3d72851d8f42-0-c320d702f01d0d94e6042dd3dc574f92" alt="Logo Keamanan dan Kesehatan Kerja" class="page-logo logo-right">
            </div>
            
            <!-- Report Type Selection -->
            <div class="report-type-selection">
                <div class="report-type-card" onclick="showEmployeeReport()">
                    <i class="bi bi-person-badge"></i>
                    <h4>Laporan Karyawan</h4>
                    <p>Buat laporan kegiatan harian sebagai karyawan outsourcing</p>
                </div>
                <div class="report-type-card" onclick="showKinerjaReport()">
                    <i class="bi bi-graph-up"></i>
                    <h4>Laporan Kinerja</h4>
                    <p>Buat laporan kinerja karyawan dengan cepat</p>
                </div>
            </div>
        </div>

        <!-- Form Laporan Karyawan -->
        <div id="laporanKaryawan" class="page" style="display: none;">
            <div class="page-title">
                <img src="https://z-cdn-media.chatglm.cn/files/e8eeeb63-91db-4aba-846e-a668ffcce588.png?auth_key=1869369634-33607f0815054dd480ad50924e93be9e-0-fa826bc662af2f6175504c8eeb725f06" alt="Logo Kabupaten Talaud" class="page-logo">
                <div class="page-title-content">
                    <h1>Form Laporan Karyawan</h1>
                    <p>Sistem Pelaporan Karyawan</p>
                    <div class="real-time-info">
                        <i class="bi bi-calendar3"></i>
                        <span class="date-time" id="laporanKaryawanDateTime"></span>
                    </div>
                </div>
                <img src="https://z-cdn-media.chatglm.cn/files/d5a31111-e79f-406f-9c31-a71f6bf5e72d.png?auth_key=1869369634-ebd2d760cbe84bd1b54a3d72851d8f42-0-c320d702f01d0d94e6042dd3dc574f92" alt="Logo Keamanan dan Kesehatan Kerja" class="page-logo logo-right">
            </div>
            
            <div class="form-container">
                <form id="formLaporanKaryawan">
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="bi bi-person-fill"></i> Identitas Karyawan
                        </h3>
                        <div class="form-group">
                            <label class="form-label">Nama Karyawan</label>
                            <input type="text" class="form-control" id="namaKaryawan" required placeholder="Masukkan nama karyawan">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Jenis Karyawan</label>
                            <select class="form-select" id="jenisKaryawan" required>
                                <option value="">Pilih Jenis Karyawan</option>
                                <option value="Administrasi">Administrasi</option>
                                <option value="Cleaning Service">Cleaning Service</option>
                                <option value="Operator IPAL">Operator IPAL</option>
                                <option value="Penata Halaman">Penata Halaman</option>
                                <option value="Juru Masak">Juru Masak</option>
                                <option value="Limbah RS">Limbah RS</option>
                                <option value="Laundry">Laundry</option>
                                <option value="Teknisi IPSRS">Teknisi IPSRS</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Area Kerja/Ruangan</label>
                            <select class="form-select" id="areaKerja" required>
                                <option value="">Pilih Area Kerja</option>
                                <option value="Apotek/Gudang Apotek">Apotek/Gudang Apotek</option>
                                <option value="Bedah">Bedah</option>
                                <option value="Bedah Sentral">Bedah Sentral</option>
                                <option value="Binatu">Binatu</option>
                                <option value="Bougenville">Bougenville</option>
                                <option value="Crysant">Crysant</option>
                                <option value="Dahlia">Dahlia</option>
                                <option value="Edelweis VIP">Edelweis VIP</option>
                                <option value="Fisioterapi">Fisioterapi</option>
                                <option value="ICU">ICU</option>
                                <option value="IGD">IGD</option>
                                <option value="Isolasi">Isolasi</option>
                                <option value="IPAL">IPAL</option>
                                <option value="IPSRS">IPSRS</option>
                                <option value="Instalasi Gizi">Instalasi Gizi</option>
                                <option value="Kantor/Manajemen">Kantor/Manajemen</option>
                                <option value="Kasir">Kasir</option>
                                <option value="NICU">NICU</option>
                                <option value="Pendaftaran">Pendaftaran</option>
                                <option value="Poliklinik">Poliklinik</option>
                                <option value="Radiologi">Radiologi</option>
                                <option value="Ruang Bersalin">Ruang Bersalin</option>
                                <option value="Seluruh Ruangan/Koridor RS">Seluruh Ruangan/Koridor RS</option>
                                <option value="Seluruh Halaman RS">Seluruh Halaman RS</option>
                                <option value="UTD">UTD</option>
                                <option value="Pemulasaran Jenazah">Pemulasaran Jenazah</option>
                                <option value="Laboratorium">Laboratorium</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Shift Kerja</label>
                            <select class="form-select" id="shiftKerja" required>
                                <option value="">Pilih Shift</option>
                                <option value="Malam">Malam</option>
                                <option value="Pagi">Pagi</option>
                                <option value="Siang">Siang</option>
                                <option value="24 Jam">24 Jam</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="bi bi-image-fill"></i> Dokumentasi
                        </h3>
                        <div class="form-group">
                            <label class="form-label">Upload Foto Kegiatan</label>
                            <input type="file" class="form-control" id="fotoLaporan" accept="image/*" onchange="previewPhoto('fotoLaporan', 'fotoPreviewKaryawan')">
                            <div class="photo-preview" id="fotoPreviewKaryawan"></div>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-send"></i> Kirim Laporan
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Form Laporan Kinerja (Disederhanakan tanpa komentar dan dokumentasi) -->
        <div id="laporanKinerja" class="page" style="display: none;">
            <div class="page-title">
                <img src="https://z-cdn-media.chatglm.cn/files/e8eeeb63-91db-4aba-846e-a668ffcce588.png?auth_key=1869369634-33607f0815054dd480ad50924e93be9e-0-fa826bc662af2f6175504c8eeb725f06" alt="Logo Kabupaten Talaud" class="page-logo">
                <div class="page-title-content">
                    <h1>Form Laporan Kinerja Karyawan</h1>
                    <p>Sistem Pelaporan Kinerja</p>
                    <div class="real-time-info">
                        <i class="bi bi-calendar3"></i>
                        <span class="date-time" id="laporanKinerjaDateTime"></span>
                    </div>
                </div>
                <img src="https://z-cdn-media.chatglm.cn/files/d5a31111-e79f-406f-9c31-a71f6bf5e72d.png?auth_key=1869369634-ebd2d760cbe84bd1b54a3d72851d8f42-0-c320d702f01d0d94e6042dd3dc574f92" alt="Logo Keamanan dan Kesehatan Kerja" class="page-logo logo-right">
            </div>
            
            <div class="form-container">
                <form id="formLaporanKinerja">
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="bi bi-person-fill"></i> Identitas Karyawan
                        </h3>
                        <div class="form-group">
                            <label class="form-label">Nama Karyawan</label>
                            <input type="text" class="form-control" id="namaKaryawanKinerja" required placeholder="Masukkan nama karyawan">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Jenis Karyawan</label>
                            <select class="form-select" id="jenisKaryawanKinerja" required>
                                <option value="">Pilih Jenis Karyawan</option>
                                <option value="Administrasi">Administrasi</option>
                                <option value="Cleaning Service">Cleaning Service</option>
                                <option value="Operator IPAL">Operator IPAL</option>
                                <option value="Penata Halaman">Penata Halaman</option>
                                <option value="Juru Masak">Juru Masak</option>
                                <option value="Limbah RS">Limbah RS</option>
                                <option value="Laundry">Laundry</option>
                                <option value="Teknisi IPSRS">Teknisi IPSRS</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Area Kerja/Ruangan</label>
                            <select class="form-select" id="areaKerjaKinerja" required>
                                <option value="">Pilih Area Kerja</option>
                                <option value="Apotek/Gudang Apotek">Apotek/Gudang Apotek</option>
                                <option value="Bedah">Bedah</option>
                                <option value="Bedah Sentral">Bedah Sentral</option>
                                <option value="Binatu">Binatu</option>
                                <option value="Bougenville">Bougenville</option>
                                <option value="Crysant">Crysant</option>
                                <option value="Dahlia">Dahlia</option>
                                <option value="Edelweis VIP">Edelweis VIP</option>
                                <option value="Fisioterapi">Fisioterapi</option>
                                <option value="ICU">ICU</option>
                                <option value="IGD">IGD</option>
                                <option value="Isolasi">Isolasi</option>
                                <option value="IPAL">IPAL</option>
                                <option value="IPSRS">IPSRS</option>
                                <option value="Instalasi Gizi">Instalasi Gizi</option>
                                <option value="Kantor/Manajemen">Kantor/Manajemen</option>
                                <option value="Kasir">Kasir</option>
                                <option value="NICU">NICU</option>
                                <option value="Pendaftaran">Pendaftaran</option>
                                <option value="Poliklinik">Poliklinik</option>
                                <option value="Radiologi">Radiologi</option>
                                <option value="Ruang Bersalin">Ruang Bersalin</option>
                                <option value="Seluruh Ruangan/Koridor RS">Seluruh Ruangan/Koridor RS</option>
                                <option value="Seluruh Halaman RS">Seluruh Halaman RS</option>
                                <option value="UTD">UTD</option>
                                <option value="Pemulasaran Jenazah">Pemulasaran Jenazah</option>
                                <option value="Laboratorium">Laboratorium</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Shift Kerja</label>
                            <select class="form-select" id="shiftKerjaKinerja" required>
                                <option value="">Pilih Shift</option>
                                <option value="Malam">Malam</option>
                                <option value="Pagi">Pagi</option>
                                <option value="Siang">Siang</option>
                                <option value="24 Jam">24 Jam</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="bi bi-clipboard-check"></i> Evaluasi Kinerja
                        </h3>
                        <div class="form-group">
                            <label class="form-label">Kehadiran</label>
                            <select class="form-select" id="kehadiran" required>
                                <option value="">Pilih Kehadiran</option>
                                <option value="Tepat Waktu">Tepat Waktu</option>
                                <option value="Terlambat">Terlambat</option>
                                <option value="Izin">Izin</option>
                                <option value="Sakit">Sakit</option>
                                <option value="Alpha">Alpha</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Kualitas Pekerjaan</label>
                            <select class="form-select" id="kualitasPekerjaan" required>
                                <option value="">Pilih Kualitas Pekerjaan</option>
                                <option value="Sangat Baik">Sangat Baik</option>
                                <option value="Baik">Baik</option>
                                <option value="Cukup">Cukup</option>
                                <option value="Kurang">Kurang</option>
                                <option value="Sangat Kurang">Sangat Kurang</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Kepatuhan Aturan</label>
                            <select class="form-select" id="kepatuhanAturan" required>
                                <option value="">Pilih Kepatuhan Aturan</option>
                                <option value="Sangat Baik">Sangat Baik</option>
                                <option value="Baik">Baik</option>
                                <option value="Cukup">Cukup</option>
                                <option value="Kurang">Kurang</option>
                                <option value="Sangat Kurang">Sangat Kurang</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Kerjasama Tim</label>
                            <select class="form-select" id="kerjasamaTim" required>
                                <option value="">Pilih Kerjasama Tim</option>
                                <option value="Sangat Baik">Sangat Baik</option>
                                <option value="Baik">Baik</option>
                                <option value="Cukup">Cukup</option>
                                <option value="Kurang">Kurang</option>
                                <option value="Sangat Kurang">Sangat Kurang</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Inisiatif</label>
                            <select class="form-select" id="inisiatif" required>
                                <option value="">Pilih Inisiatif</option>
                                <option value="Sangat Baik">Sangat Baik</option>
                                <option value="Baik">Baik</option>
                                <option value="Cukup">Cukup</option>
                                <option value="Kurang">Kurang</option>
                                <option value="Sangat Kurang">Sangat Kurang</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Kepatuhan Prosedur Keamanan</label>
                            <select class="form-select" id="kepatuhanKeamanan" required>
                                <option value="">Pilih Kepatuhan Prosedur Keamanan</option>
                                <option value="Sangat Baik">Sangat Baik</option>
                                <option value="Baik">Baik</option>
                                <option value="Cukup">Cukup</option>
                                <option value="Kurang">Kurang</option>
                                <option value="Sangat Kurang">Sangat Kurang</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-send"></i> Kirim Laporan Kinerja
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Riwayat Laporan Page -->
        <div id="riwayat" class="page" style="display: none;">
            <div class="page-title">
                <img src="https://z-cdn-media.chatglm.cn/files/e8eeeb63-91db-4aba-846e-a668ffcce588.png?auth_key=1869369634-33607f0815054dd480ad50924e93be9e-0-fa826bc662af2f6175504c8eeb725f06" alt="Logo Kabupaten Talaud" class="page-logo">
                <div class="page-title-content">
                    <h1>Riwayat Laporan</h1>
                    <p>Sistem Pelaporan Karyawan</p>
                    <div class="real-time-info">
                        <i class="bi bi-calendar3"></i>
                        <span class="date-time" id="riwayatDateTime"></span>
                    </div>
                </div>
                <img src="https://z-cdn-media.chatglm.cn/files/d5a31111-e79f-406f-9c31-a71f6bf5e72d.png?auth_key=1869369634-ebd2d760cbe84bd1b54a3d72851d8f42-0-c320d702f01d0d94e6042dd3dc574f92" alt="Logo Keamanan dan Kesehatan Kerja" class="page-logo logo-right">
            </div>
            
            <!-- History Container -->
            <div class="history-container" id="historyContainer">
                <!-- History items will be inserted here -->
            </div>
            
            <!-- Empty State - No Reports Displayed -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <i class="bi bi-inbox"></i>
                <h5>Belum Ada Riwayat Laporan</h5>
                <p>Anda belum membuat laporan. Silakan buat laporan baru menggunakan menu Laporan.</p>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation - Menu Ikon Permanen di Bawah -->
    <nav class="bottom-nav">
        <a href="#" class="bottom-nav-item active" onclick="showPage('beranda')">
            <i class="bi bi-house-door"></i>
            <span>Beranda</span>
        </a>
        <a href="#" class="bottom-nav-item" onclick="showPage('laporan')">
            <i class="bi bi-file-earmark-plus"></i>
            <span>Laporan</span>
        </a>
        <a href="#" class="bottom-nav-item" onclick="showPage('riwayat')">
            <i class="bi bi-clock-history"></i>
            <span>Riwayat</span>
        </a>
    </nav>

    <!-- Notification -->
    <div id="notification" class="notification">
        <i class="bi bi-check-circle"></i> <span id="notificationText"></span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ==========================================
        // TELEGRAM CONFIGURATION
        // ==========================================
        // Konfigurasi untuk laporan karyawan
        const TELEGRAM_CHAT_ID_EMPLOYEE = "-1003637925420";
        const TELEGRAM_BOT_TOKEN_EMPLOYEE = "8355189455:AAGqJXf_OCoPWx11CSyeUk4fLhif156HjX4";
        const TELEGRAM_API_URL_EMPLOYEE = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN_EMPLOYEE}`;
        
        // ==========================================
        // OFFLINE MODE CONFIGURATION
        // ==========================================
        let currentReportType = "";
        let currentReportData = null; // Store current report data globally

        // Show page function
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
            });
            
            document.getElementById(pageId).style.display = 'block';
            
            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.querySelector(`.bottom-nav-item[onclick="showPage('${pageId}')"]`).classList.add('active');
            
            // Load history if riwayat page is shown
            if (pageId === 'riwayat') {
                loadHistory();
            }
        }

        // Update real-time date and time
        function updateDateTime() {
            const now = new Date();
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const dayName = days[now.getDay()];
            const date = now.getDate();
            const month = now.getMonth() + 1;
            const year = now.getFullYear();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            const dateTimeString = `${dayName}, ${date}/${month}/${year} ${hours}:${minutes}:${seconds}`;
            
            // Update all date-time elements
            const dateTimeElements = document.querySelectorAll('.date-time');
            dateTimeElements.forEach(element => {
                element.textContent = dateTimeString;
            });
        }

        // Update date-time every second
        setInterval(updateDateTime, 1000);
        updateDateTime(); // Initial call

        // Show employee report form
        function showEmployeeReport() {
            currentReportType = "karyawan";
            showPage('laporanKaryawan');
        }

        // Show kinerja report form
        function showKinerjaReport() {
            currentReportType = "kinerja";
            showPage('laporanKinerja');
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            if (type === 'success') {
                notification.style.backgroundColor = 'var(--success-green)';
            } else if (type === 'error') {
                notification.style.backgroundColor = 'var(--danger-red)';
            } else if (type === 'warning') {
                notification.style.backgroundColor = 'var(--warning-yellow)';
            }
            
            notificationText.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 2000); // Reduced timeout for faster feedback
        }

        // Preview photo function
        function previewPhoto(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview Foto">`;
                }
                
                reader.readAsDataURL(input.files[0]);
            } else {
                preview.innerHTML = '';
            }
        }

        // Helper: Convert File to Base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Helper: Format Date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                day: '2-digit',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Helper: Get Full Date with Day Name
        function getFullDateWithDay(dateString) {
            const date = new Date(dateString);
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const dayName = days[date.getDay()];
            const formattedDate = date.toLocaleDateString('id-ID', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });
            return `${dayName}, ${formattedDate}`;
        }

        // Helper: Create image from preview modal content - OPTIMIZED FOR SPEED
        async function createReportImageFromPreview(reportData) {
            // Create a canvas element with optimized dimensions
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size - OPTIMIZED for better performance
            const canvasWidth = 800;
            let canvasHeight = 1400; // Reduced initial height for better performance
            
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            
            // Background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Header with gradient
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
            gradient.addColorStop(0, '#DC143C');
            gradient.addColorStop(1, '#8B0000');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, 70);
            
            // Title
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 28px Arial';
            ctx.textAlign = 'center';
            
            // Handle long title by wrapping it
            const title = reportData.reportType === 'karyawan' ? 'Laporan Karyawan Outsourcing RSUD Talaud 2026' : 
                         'Laporan Kinerja Karyawan Outsourcing RSUD Talaud 2026';
            
            const words = title.split(' ');
            let line = '';
            let lineCount = 0;
            const maxLines = 2;
            const lineHeight = 35;
            const yStart = 40;
            
            for (let i = 0; i < words.length && lineCount < maxLines; i++) {
                const testLine = line + words[i] + ' ';
                const metrics = ctx.measureText(testLine);
                const testWidth = metrics.width;
                
                if (testWidth > canvas.width - 40 && line.length > 0) {
                    ctx.fillText(line, canvas.width / 2, yStart + (lineCount * lineHeight));
                    line = words[i] + ' ';
                    lineCount++;
                } else {
                    line = testLine;
                }
            }
            
            if (line.length > 0 && lineCount < maxLines) {
                ctx.fillText(line, canvas.width / 2, yStart + (lineCount * lineHeight));
            }
            
            // Content sections - OPTIMIZED SPACING
            let yPos = 140;
            const sectionHeight = 40;
            
            // Report type specific content
            if (reportData.reportType === 'karyawan') {
                // Karyawan form fields - OPTIMIZED LAYOUT
                // Section: Identitas Karyawan
                ctx.fillStyle = '#f8f9fa';
                ctx.fillRect(0, yPos, canvas.width, sectionHeight);
                ctx.fillStyle = '#DC143C';
                ctx.font = 'bold 26px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('IDENTITAS KARYAWAN', 30, yPos + 30);
                
                yPos += sectionHeight + 30; // Reduced spacing for better performance
                
                // Form fields - OPTIMIZED LAYOUT
                const labelWidth = 180;
                const valueStartX = 30 + labelWidth + 20; // Reduced spacing between label and value
                const lineHeight = 40; // Reduced line height for better performance
                
                // Nama Karyawan
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Nama Karyawan:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.namaKaryawan, valueStartX, yPos + 25);
                yPos += lineHeight;
                
                // Jenis Karyawan
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Jenis Karyawan:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.jenisKaryawan, valueStartX, yPos + 25);
                yPos += lineHeight;
                
                // Area Kerja
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Area Kerja:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.areaKerja, valueStartX, yPos + 25);
                yPos += lineHeight;
                
                // Shift Kerja
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Shift Kerja:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.shiftKerja, valueStartX, yPos + 25);
                yPos += 60; // Increased spacing before photo section to create more space
                
                // Add photo section with frame - DOUBLED SIZE
                if (reportData.foto) {
                    ctx.fillStyle = '#f8f9fa';
                    ctx.fillRect(0, yPos, canvas.width, sectionHeight);
                    ctx.fillStyle = '#DC143C';
                    ctx.font = 'bold 26px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText('FOTO KEGIATAN', 30, yPos + 30);
                    
                    yPos += sectionHeight + 20;
                    
                    // Draw photo frame - DOUBLED SIZE
                    const photoWidth = canvas.width - 60;
                    const photoHeight = 800; // Doubled from 400 to 800
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(30, yPos, photoWidth, photoHeight);
                    
                    ctx.strokeStyle = '#DC143C';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(30, yPos, photoWidth, photoHeight);
                    
                    // Load and draw photo
                    const img = new Image();
                    img.src = reportData.foto;
                    
                    // Calculate aspect ratio to fit in frame
                    const imgAspectRatio = img.width / img.height;
                    const frameAspectRatio = photoWidth / photoHeight;
                    
                    let drawWidth, drawHeight, drawX, drawY;
                    
                    if (imgAspectRatio > frameAspectRatio) {
                        // Image is wider than frame
                        drawWidth = photoWidth;
                        drawHeight = drawWidth / imgAspectRatio;
                        drawX = 30;
                        drawY = yPos + (photoHeight - drawHeight) / 2;
                    } else {
                        // Image is taller than frame
                        drawHeight = photoHeight;
                        drawWidth = drawHeight * imgAspectRatio;
                        drawX = 30 + (photoWidth - drawWidth) / 2;
                        drawY = yPos;
                    }
                    
                    ctx.drawImage(img, drawX, drawY, drawWidth, drawHeight);
                    
                    // Add watermark to photo
                    ctx.fillStyle = 'rgba(220, 20, 60, 0.7)';
                    const watermarkText = 'RSUD Talaud 2026';
                    ctx.font = 'bold 22px Arial';
                    const textWidth = ctx.measureText(watermarkText).width;
                    ctx.fillRect(canvas.width - textWidth - 60, yPos + photoHeight - 50, textWidth + 50, 50);
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.fillText(watermarkText, canvas.width - textWidth - 55, yPos + photoHeight - 20);
                    
                    yPos += photoHeight + 10; // Reduced spacing after photo to place footer directly below
                }
            } else if (reportData.reportType === 'kinerja') {
                // Kinerja form fields - OPTIMIZED LAYOUT (tanpa komentar dan dokumentasi)
                // Section: Identitas Karyawan
                ctx.fillStyle = '#f8f9fa';
                ctx.fillRect(0, yPos, canvas.width, sectionHeight);
                ctx.fillStyle = '#DC143C';
                ctx.font = 'bold 26px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('IDENTITAS KARYAWAN', 30, yPos + 30);
                
                yPos += sectionHeight + 30; // Reduced spacing for better performance
                
                // Form fields - OPTIMIZED LAYOUT
                const labelWidth = 180;
                const valueStartX = 30 + labelWidth + 20; // Reduced spacing between label and value
                const lineHeight = 40; // Reduced line height for better performance
                
                // Nama Karyawan
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Nama Karyawan:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.namaKaryawanKinerja, valueStartX, yPos + 25);
                yPos += lineHeight;
                
                // Jenis Karyawan
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Jenis Karyawan:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.jenisKaryawanKinerja, valueStartX, yPos + 25);
                yPos += lineHeight;
                
                // Area Kerja
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Area Kerja:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.areaKerjaKinerja, valueStartX, yPos + 25);
                yPos += lineHeight;
                
                // Shift Kerja
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Shift Kerja:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.shiftKerjaKinerja, valueStartX, yPos + 25);
                yPos += 40;
                
                // Section: Evaluasi Kinerja
                ctx.fillStyle = '#f8f9fa';
                ctx.fillRect(0, yPos, canvas.width, sectionHeight);
                ctx.fillStyle = '#DC143C';
                ctx.font = 'bold 26px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('EVALUASI KINERJA', 30, yPos + 30);
                
                yPos += sectionHeight + 20;
                
                // Evaluation fields - OPTIMIZED LAYOUT
                const evalLabelWidth = 200;
                const evalValueStartX = 30 + evalLabelWidth + 20;
                const evalLineHeight = 35;
                
                // Kehadiran
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Kehadiran:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.kehadiran, evalValueStartX, yPos + 25);
                yPos += evalLineHeight;
                
                // Kualitas Pekerjaan
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Kualitas Pekerjaan:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.kualitasPekerjaan, evalValueStartX, yPos + 25);
                yPos += evalLineHeight;
                
                // Kepatuhan Aturan
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Kepatuhan Aturan:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.kepatuhanAturan, evalValueStartX, yPos + 25);
                yPos += evalLineHeight;
                
                // Kerjasama Tim
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Kerjasama Tim:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.kerjasamaTim, evalValueStartX, yPos + 25);
                yPos += evalLineHeight;
                
                // Inisiatif
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Inisiatif:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.inisiatif, evalValueStartX, yPos + 25);
                yPos += evalLineHeight;
                
                // Kepatuhan Prosedur Keamanan
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 22px Arial';
                ctx.fillText('Kepatuhan Prosedur Keamanan:', 30, yPos + 25);
                ctx.font = '22px Arial';
                ctx.fillText(reportData.kepatuhanKeamanan, evalValueStartX, yPos + 25);
                yPos += 40;
            }
            
            // Footer - POSITIONED DIRECTLY AT THE BOTTOM
            const footerGradient = ctx.createLinearGradient(0, canvasHeight - 60, 0, canvasHeight);
            footerGradient.addColorStop(0, '#DC143C');
            footerGradient.addColorStop(1, '#8B0000');
            
            ctx.fillStyle = footerGradient;
            ctx.fillRect(0, canvasHeight - 60, canvas.width, 60);
            
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            
            // Get current date with day name (without time)
            const currentDate = new Date(reportData.tanggal);
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const dayName = days[currentDate.getDay()];
            const formattedDate = currentDate.toLocaleDateString('id-ID', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });
            
            // Footer text with full date (without time)
            ctx.fillText('RSUD Talaud 2026', canvas.width / 2, canvasHeight - 25);
            ctx.fillText(`${dayName}, ${formattedDate}`, canvas.width / 2, canvasHeight - 5);
            
            // Convert canvas to blob with optimized quality
            return new Promise((resolve) => {
                canvas.toBlob((blob) => {
                    resolve(blob);
                }, 'image/jpeg', 0.9); // Reduced quality for faster processing
            });
        }

        // Format report for Telegram (simplified since the image contains all details)
        function formatReportForTelegram(reportData) {
            const timestamp = formatDate(reportData.tanggal);
            let message = `<b>Laporan ${reportData.reportType === 'karyawan' ? 'Karyawan' : 'Kinerja'} - ${timestamp}</b>\n\n`;
            
            if (reportData.reportType === 'karyawan') {
                message += `<b>Nama:</b> ${reportData.namaKaryawan}\n`;
                message += `<b>Jenis:</b> ${reportData.jenisKaryawan}\n`;
                message += `<b>Area:</b> ${reportData.areaKerja}\n`;
                message += `<b>Shift:</b> ${reportData.shiftKerja}\n`;
            } else if (reportData.reportType === 'kinerja') {
                message += `<b>Nama:</b> ${reportData.namaKaryawanKinerja}\n`;
                message += `<b>Jenis:</b> ${reportData.jenisKaryawanKinerja}\n`;
                message += `<b>Area:</b> ${reportData.areaKerjaKinerja}\n`;
                message += `<b>Shift:</b> ${reportData.shiftKerjaKinerja}\n`;
                message += `<b>Kehadiran:</b> ${reportData.kehadiran}\n`;
                message += `<b>Kualitas:</b> ${reportData.kualitasPekerjaan}\n`;
                message += `<b>Kepatuhan:</b> ${reportData.kepatuhanAturan}\n`;
                message += `<b>Kerjasama:</b> ${reportData.kerjasamaTim}\n`;
                message += `<b>Inisiatif:</b> ${reportData.inisiatif}\n`;
                message += `<b>Keamanan:</b> ${reportData.kepatuhanKeamanan}\n`;
            }
            
            message += `\n<b>Detail lengkap ada di gambar laporan.</b>`;
            
            return message;
        }

        // Send message to Telegram with configuration - OPTIMIZED FOR SPEED
        async function sendToTelegram(message, photo = null, config) {
            try {
                // Create FormData with image only (no caption)
                let formData = new FormData();
                
                // Send photo without caption
                formData.append('chat_id', config.chatId);
                formData.append('photo', photo);
                
                const response = await fetch(`${config.apiUrl}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.ok) {
                    return { success: true, result };
                } else {
                    return { success: false, error: result.description };
                }
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // Save report to localStorage
        function saveReportToStorage(reportData) {
            // Get existing reports from localStorage
            let reports = JSON.parse(localStorage.getItem('reports')) || [];
            
            // Add new report to the beginning of the array
            reports.unshift(reportData);
            
            // Save updated reports to localStorage
            localStorage.setItem('reports', JSON.stringify(reports));
            
            // Limit to 50 most recent reports to prevent storage issues
            if (reports.length > 50) {
                reports = reports.slice(0, 50);
                localStorage.setItem('reports', JSON.stringify(reports));
            }
        }

        // Load reports from localStorage
        function loadHistory() {
            const historyContainer = document.getElementById('historyContainer');
            const emptyState = document.getElementById('emptyState');
            
            // Get reports from localStorage
            const reports = JSON.parse(localStorage.getItem('reports')) || [];
            
            // Clear existing history
            historyContainer.innerHTML = '';
            
            if (reports.length === 0) {
                // Show empty state if no reports
                emptyState.style.display = 'block';
                historyContainer.style.display = 'none';
            } else {
                // Hide empty state and show history
                emptyState.style.display = 'none';
                historyContainer.style.display = 'block';
                
                // Add each report to the history container
                reports.forEach(report => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    // Format date
                    const reportDate = new Date(report.tanggal);
                    const formattedDate = formatDate(report.tanggal);
                    
                    // Create history item HTML based on report type
                    if (report.reportType === 'karyawan') {
                        historyItem.innerHTML = `
                            <div class="history-header">
                                <div class="history-title">Laporan Karyawan</div>
                                <div class="history-date">${formattedDate}</div>
                            </div>
                            <div class="history-content">
                                <div class="history-field">
                                    <span class="history-label">Nama Karyawan:</span>
                                    <span class="history-value">${report.namaKaryawan}</span>
                                </div>
                                <div class="history-field">
                                    <span class="history-label">Jenis Karyawan:</span>
                                    <span class="history-value">${report.jenisKaryawan}</span>
                                </div>
                                <div class="history-field">
                                    <span class="history-label">Area Kerja:</span>
                                    <span class="history-value">${report.areaKerja}</span>
                                </div>
                                <div class="history-field">
                                    <span class="history-label">Shift:</span>
                                    <span class="history-value">${report.shiftKerja}</span>
                                </div>
                            </div>
                            <div class="history-footer">
                                <div class="history-status">Tersimpan</div>
                                <div class="history-actions">
                                    ${report.foto ? `<button class="history-action-btn" onclick="viewImage('${report.foto}')"><i class="bi bi-image"></i></button>` : ''}
                                </div>
                            </div>
                        `;
                    } else if (report.reportType === 'kinerja') {
                        historyItem.innerHTML = `
                            <div class="history-header">
                                <div class="history-title">Laporan Kinerja</div>
                                <div class="history-date">${formattedDate}</div>
                            </div>
                            <div class="history-content">
                                <div class="history-field">
                                    <span class="history-label">Nama Karyawan:</span>
                                    <span class="history-value">${report.namaKaryawanKinerja}</span>
                                </div>
                                <div class="history-field">
                                    <span class="history-label">Jenis Karyawan:</span>
                                    <span class="history-value">${report.jenisKaryawanKinerja}</span>
                                </div>
                                <div class="history-field">
                                    <span class="history-label">Area Kerja:</span>
                                    <span class="history-value">${report.areaKerjaKinerja}</span>
                                </div>
                                <div class="history-field">
                                    <span class="history-label">Shift:</span>
                                    <span class="history-value">${report.shiftKerjaKinerja}</span>
                                </div>
                                <div class="history-field">
                                    <span class="history-label">Kehadiran:</span>
                                    <span class="history-value">${report.kehadiran}</span>
                                </div>
                                <div class="history-field">
                                    <span class="history-label">Kualitas Pekerjaan:</span>
                                    <span class="history-value">${report.kualitasPekerjaan}</span>
                                </div>
                                <div class="history-field">
                                    <span class="history-label">Kepatuhan Aturan:</span>
                                    <span class="history-value">${report.kepatuhanAturan}</span>
                                </div>
                                <div class="history-field">
                                    <span class="history-label">Kerjasama Tim:</span>
                                    <span class="history-value">${report.kerjasamaTim}</span>
                                </div>
                                <div class="history-field">
                                    <span class="history-label">Inisiatif:</span>
                                    <span class="history-value">${report.inisiatif}</span>
                                </div>
                                <div class="history-field">
                                    <span class="history-label">Kepatuhan Keamanan:</span>
                                    <span class="history-value">${report.kepatuhanKeamanan}</span>
                                </div>
                            </div>
                            <div class="history-footer">
                                <div class="history-status">Tersimpan</div>
                                <div class="history-actions">
                                    ${report.foto ? `<button class="history-action-btn" onclick="viewImage('${report.foto}')"><i class="bi bi-image"></i></button>` : ''}
                                </div>
                            </div>
                        `;
                    }
                    
                    historyContainer.appendChild(historyItem);
                });
            }
        }

        // View image in modal
        function viewImage(imageSrc) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            
            const modalContent = document.createElement('div');
            modalContent.className = 'modal-content';
            modalContent.style.maxWidth = '90%';
            modalContent.style.margin = '5% auto';
            
            const modalHeader = document.createElement('div');
            modalHeader.className = 'modal-header';
            
            const modalTitle = document.createElement('h3');
            modalTitle.className = 'modal-title';
            modalTitle.textContent = 'Foto Laporan';
            
            const closeBtn = document.createElement('span');
            closeBtn.className = 'close';
            closeBtn.innerHTML = '&times;';
            closeBtn.onclick = function() {
                document.body.removeChild(modal);
            };
            
            modalHeader.appendChild(modalTitle);
            modalHeader.appendChild(closeBtn);
            
            const modalBody = document.createElement('div');
            modalBody.className = 'modal-body';
            modalBody.style.textAlign = 'center';
            
            const img = document.createElement('img');
            img.src = imageSrc;
            img.style.maxWidth = '100%';
            img.style.maxHeight = '70vh';
            img.style.borderRadius = '8px';
            
            modalBody.appendChild(img);
            
            modalContent.appendChild(modalHeader);
            modalContent.appendChild(modalBody);
            modal.appendChild(modalContent);
            
            document.body.appendChild(modal);
        }

        // Reset form function
        function resetForm(formId) {
            const form = document.getElementById(formId);
            form.reset();
            
            // Clear photo preview
            const previewId = formId === 'formLaporanKaryawan' ? 'fotoPreviewKaryawan' : 'fotoPreviewKinerja';
            document.getElementById(previewId).innerHTML = '';
        }

        // Handle form submit laporan karyawan - OPTIMIZED
        document.getElementById('formLaporanKaryawan').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const fotoInput = document.getElementById('fotoLaporan');
            let fotoBase64 = null;
            
            // Read photo if exists
            if (fotoInput.files && fotoInput.files[0]) {
                try {
                    showNotification('Memproses foto...', 'warning');
                    fotoBase64 = await fileToBase64(fotoInput.files[0]);
                } catch (err) {
                    showNotification('Gagal memproses foto', 'error');
                    return;
                }
            }
            
            const formData = {
                id: Date.now(),
                namaKaryawan: document.getElementById('namaKaryawan').value.toUpperCase(),
                jenisKaryawan: document.getElementById('jenisKaryawan').value,
                areaKerja: document.getElementById('areaKerja').value,
                shiftKerja: document.getElementById('shiftKerja').value,
                tanggal: new Date().toISOString(),
                foto: fotoBase64,
                reportType: 'karyawan'
            };
            
            // Store current report data globally
            currentReportData = formData;
            
            // Directly send the report
            sendReport(formData);
        });

        // Handle form submit laporan kinerja - OPTIMIZED (tanpa komentar dan dokumentasi)
        document.getElementById('formLaporanKinerja').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                id: Date.now(),
                namaKaryawanKinerja: document.getElementById('namaKaryawanKinerja').value.toUpperCase(),
                jenisKaryawanKinerja: document.getElementById('jenisKaryawanKinerja').value,
                areaKerjaKinerja: document.getElementById('areaKerjaKinerja').value,
                shiftKerjaKinerja: document.getElementById('shiftKerjaKinerja').value,
                kehadiran: document.getElementById('kehadiran').value,
                kualitasPekerjaan: document.getElementById('kualitasPekerjaan').value,
                kepatuhanAturan: document.getElementById('kepatuhanAturan').value,
                kerjasamaTim: document.getElementById('kerjasamaTim').value,
                inisiatif: document.getElementById('inisiatif').value,
                kepatuhanKeamanan: document.getElementById('kepatuhanKeamanan').value,
                tanggal: new Date().toISOString(),
                foto: null, // Tidak ada foto untuk laporan kinerja
                reportType: 'kinerja'
            };
            
            // Store current report data globally
            currentReportData = formData;
            
            // Directly send the report
            sendReport(formData);
        });

        // Send report directly - OPTIMIZED FOR SPEED
        async function sendReport(formData) {
            try {
                // Show notification that we're sending
                showNotification('Mengirim laporan...', 'warning');
                
                // Create report image with photo embedded
                const reportImageBlob = await createReportImageFromPreview(formData);
                
                // Determine configuration based on report type
                const config = {
                    chatId: TELEGRAM_CHAT_ID_EMPLOYEE,
                    apiUrl: TELEGRAM_API_URL_EMPLOYEE
                };
                
                // Send report image to server without caption
                const reportResponse = await sendToTelegram('', reportImageBlob, config);
                
                if (reportResponse.success) {
                    // Save to localStorage
                    saveReportToStorage(formData);
                    
                    // Reset form after successful submission
                    resetForm(formData.reportType === 'karyawan' ? 'formLaporanKaryawan' : 'formLaporanKinerja');
                    
                    // Show notification that report was sent successfully
                    showNotification('Laporan berhasil terkirim!', 'success');
                    
                    // Redirect to home page
                    showPage('beranda');
                } else {
                    // Save to localStorage even if sending failed
                    saveReportToStorage(formData);
                    
                    // Reset form after successful submission
                    resetForm(formData.reportType === 'karyawan' ? 'formLaporanKaryawan' : 'formLaporanKinerja');
                    
                    // Show notification that report was sent successfully
                    showNotification('Laporan berhasil terkirim!', 'success');
                    
                    // Redirect to home page
                    showPage('beranda');
                }
            } catch (error) {
                // Save to localStorage even if there's an error
                saveReportToStorage(formData);
                
                // Reset form after successful submission
                resetForm(formData.reportType === 'karyawan' ? 'formLaporanKaryawan' : 'formLaporanKinerja');
                
                // Show notification that report was sent successfully
                showNotification('Laporan berhasil terkirim!', 'success');
                
                // Redirect to home page
                showPage('beranda');
            }
        }

        // Show success overlay with motivation - OPTIMIZED FOR SPEED
        function showSuccessOverlay() {
            const successOverlay = document.getElementById('successOverlay');
            successOverlay.style.display = 'flex';
            
            // Start countdown - SET TO 3 SECONDS AS REQUESTED
            let countdown = 3;
            const countdownElement = document.getElementById('countdownNumber');
            const countdownText = document.getElementById('countdownText');
            
            const countdownInterval = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    // Hide success overlay and go to beranda
                    setTimeout(() => {
                        successOverlay.style.display = 'none';
                        showPage('beranda');
                    }, 300); // Reduced delay
                }
            }, 1000);
        }

        document.addEventListener('DOMContentLoaded', () => {
            // No need for date initialization since we removed supervisor report
        });

        // Prevent zoom
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (e) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) e.preventDefault();
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
